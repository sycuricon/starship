diff --git a/riscv/csrs.cc b/riscv/csrs.cc
index 0eee40de..78f7de54 100644
--- a/riscv/csrs.cc
+++ b/riscv/csrs.cc
@@ -1688,3 +1688,13 @@ bool smcntrpmf_csr_t::unlogged_write(const reg_t val) noexcept {
   prev_val = read();
   return masked_csr_t::unlogged_write(val);
 }
+
+key_csr_t::key_csr_t(processor_t* const proc, const reg_t addr, const reg_t init):
+  csr_t(proc, addr),
+  val(init) {
+}
+
+bool key_csr_t::unlogged_write(const reg_t val) noexcept {
+  this->val = val;
+  return true;
+}
\ No newline at end of file
diff --git a/riscv/csrs.h b/riscv/csrs.h
index efa7f10a..be0e61ff 100644
--- a/riscv/csrs.h
+++ b/riscv/csrs.h
@@ -842,4 +842,19 @@ class smcntrpmf_csr_t : public masked_csr_t {
  private:
   std::optional<reg_t> prev_val;
 };
+
+class key_csr_t: public csr_t {
+ public:
+  key_csr_t(processor_t* const proc, const reg_t addr, const reg_t init);
+
+  virtual reg_t read() const noexcept override {
+    return val;
+  }
+
+ protected:
+  virtual bool unlogged_write(const reg_t val) noexcept override;
+ private:
+  reg_t val;
+};
+
 #endif
diff --git a/riscv/decode.h b/riscv/decode.h
index f7ca8e87..e2df55f5 100644
--- a/riscv/decode.h
+++ b/riscv/decode.h
@@ -93,6 +93,8 @@ public:
   uint64_t iorw() { return x(20, 8); }
   uint64_t bs() { return x(30, 2); } // Crypto ISE - SM4/AES32 byte select.
   uint64_t rcon() { return x(20, 4); } // Crypto ISE - AES64 round const.
+  uint64_t rgvlt_startb() { return x(26, 3); }
+  uint64_t rgvlt_endb() { return x(29, 3); }
 
   int64_t rvc_imm() { return x(2, 5) + (xs(12, 1) << 5); }
   int64_t rvc_zimm() { return x(2, 5) + (x(12, 1) << 5); }
diff --git a/riscv/encoding.h b/riscv/encoding.h
index a7e2d945..7fe37074 100644
--- a/riscv/encoding.h
+++ b/riscv/encoding.h
@@ -4,7 +4,7 @@
 
 /*
  * This file is auto-generated by running 'make' in
- * https://github.com/riscv/riscv-opcodes (d752f19)
+ * https://github.com/riscv/riscv-opcodes (61d2ef4)
  */
 
 #ifndef RISCV_CSR_ENCODING_H
@@ -29,6 +29,7 @@
 #define MSTATUS_TVM         0x00100000
 #define MSTATUS_TW          0x00200000
 #define MSTATUS_TSR         0x00400000
+#define MSTATUS_SPELP       0x00800000
 #define MSTATUS32_SD        0x80000000
 #define MSTATUS_UXL         0x0000000300000000
 #define MSTATUS_SXL         0x0000000C00000000
@@ -36,6 +37,7 @@
 #define MSTATUS_MBE         0x0000002000000000
 #define MSTATUS_GVA         0x0000004000000000
 #define MSTATUS_MPV         0x0000008000000000
+#define MSTATUS_MPELP       0x0000020000000000
 #define MSTATUS64_SD        0x8000000000000000
 
 #define MSTATUSH_SBE        0x00000010
@@ -54,6 +56,7 @@
 #define SSTATUS_XS          0x00018000
 #define SSTATUS_SUM         0x00040000
 #define SSTATUS_MXR         0x00080000
+#define SSTATUS_SPELP       0x00800000
 #define SSTATUS32_SD        0x80000000
 #define SSTATUS_UXL         0x0000000300000000
 #define SSTATUS64_SD        0x8000000000000000
@@ -79,6 +82,7 @@
 #define DCSR_XDEBUGVER      (3U<<30)
 #define DCSR_NDRESET        (1<<29)
 #define DCSR_FULLRESET      (1<<28)
+#define DCSR_PELP           (1<<18)
 #define DCSR_EBREAKM        (1<<15)
 #define DCSR_EBREAKH        (1<<14)
 #define DCSR_EBREAKS        (1<<13)
@@ -157,6 +161,8 @@
 #define SIP_STIP MIP_STIP
 
 #define MENVCFG_FIOM  0x00000001
+#define MENVCFG_LPE   0x00000004
+#define MENVCFG_SSE   0x00000008
 #define MENVCFG_CBIE  0x00000030
 #define MENVCFG_CBCFE 0x00000040
 #define MENVCFG_CBZE  0x00000080
@@ -195,6 +201,8 @@
 #define MHPMEVENTH_OF    0x80000000
 
 #define HENVCFG_FIOM  0x00000001
+#define HENVCFG_LPE   0x00000004
+#define HENVCFG_SSE   0x00000008
 #define HENVCFG_CBIE  0x00000030
 #define HENVCFG_CBCFE 0x00000040
 #define HENVCFG_CBZE  0x00000080
@@ -230,6 +238,8 @@
 #define HSTATEENH_SSTATEEN  0x80000000
 
 #define SENVCFG_FIOM  0x00000001
+#define SENVCFG_LPE   0x00000004
+#define SENVCFG_SSE   0x00000008
 #define SENVCFG_CBIE  0x00000030
 #define SENVCFG_CBCFE 0x00000040
 #define SENVCFG_CBZE  0x00000080
@@ -243,6 +253,7 @@
 #define MSECCFG_RLB    0x00000004
 #define MSECCFG_USEED  0x00000100
 #define MSECCFG_SSEED  0x00000200
+#define MSECCFG_MLPE   0x00000400
 
 /* jvt fields */
 #define JVT_MODE   0x3F
@@ -624,6 +635,10 @@
 #define MASK_C_SRAI 0xec03
 #define MATCH_C_SRLI 0x8001
 #define MASK_C_SRLI 0xec03
+#define MATCH_C_SSPOPCHK_X5 0x6281
+#define MASK_C_SSPOPCHK_X5 0xffff
+#define MATCH_C_SSPUSH_X1 0x6081
+#define MASK_C_SSPUSH_X1 0xffff
 #define MATCH_C_SUB 0x8c01
 #define MASK_C_SUB 0xfc63
 #define MATCH_C_SUBW 0x9c01
@@ -716,6 +731,10 @@
 #define MASK_CRC32C_H 0xfff0707f
 #define MATCH_CRC32C_W 0x61a01013
 #define MASK_CRC32C_W 0xfff0707f
+#define MATCH_CRDXK 0x200006b
+#define MASK_CRDXK 0x200007f
+#define MATCH_CREXK 0x6b
+#define MASK_CREXK 0x200007f
 #define MATCH_CRSA16 0x46000077
 #define MASK_CRSA16 0xfe00707f
 #define MATCH_CRSA32 0x46002077
@@ -1834,6 +1853,20 @@
 #define MASK_SROIW 0xfe00707f
 #define MATCH_SROW 0x2000503b
 #define MASK_SROW 0xfe00707f
+#define MATCH_SSAMOSWAP_D 0x4800302f
+#define MASK_SSAMOSWAP_D 0xf800707f
+#define MATCH_SSAMOSWAP_W 0x4800202f
+#define MASK_SSAMOSWAP_W 0xf800707f
+#define MATCH_SSPOPCHK_X1 0xcdc0c073
+#define MASK_SSPOPCHK_X1 0xffffffff
+#define MATCH_SSPOPCHK_X5 0xcdc2c073
+#define MASK_SSPOPCHK_X5 0xffffffff
+#define MATCH_SSPUSH_X1 0xce104073
+#define MASK_SSPUSH_X1 0xffffffff
+#define MATCH_SSPUSH_X5 0xce504073
+#define MASK_SSPUSH_X5 0xffffffff
+#define MATCH_SSRDP 0xcdc04073
+#define MASK_SSRDP 0xfffff07f
 #define MATCH_STAS16 0xf4002077
 #define MASK_STAS16 0xfe00707f
 #define MATCH_STAS32 0xf0002077
@@ -3016,6 +3049,7 @@
 #define CSR_VXSAT 0x9
 #define CSR_VXRM 0xa
 #define CSR_VCSR 0xf
+#define CSR_SSP 0x11
 #define CSR_SEED 0x15
 #define CSR_JVT 0x17
 #define CSR_CYCLE 0xc00
@@ -3331,6 +3365,22 @@
 #define CSR_MHARTID 0xf14
 #define CSR_MCONFIGPTR 0xf15
 #define CSR_MTOPI 0xfb0
+#define CSR_MCRMKEYL 0x7f0
+#define CSR_MCRMKEYH 0x7f1
+#define CSR_SCRTKEYL 0x5f0
+#define CSR_SCRTKEYH 0x5f1
+#define CSR_SCRAKEYL 0x5f2
+#define CSR_SCRAKEYH 0x5f3
+#define CSR_SCRBKEYL 0x5f4
+#define CSR_SCRBKEYH 0x5f5
+#define CSR_SCRCKEYL 0x5f6
+#define CSR_SCRCKEYH 0x5f7
+#define CSR_SCRDKEYL 0x5f8
+#define CSR_SCRDKEYH 0x5f9
+#define CSR_SCREKEYL 0x5fa
+#define CSR_SCREKEYH 0x5fb
+#define CSR_SCRFKEYL 0x5fc
+#define CSR_SCRFKEYH 0x5fd
 #define CSR_SIEH 0x114
 #define CSR_SIPH 0x154
 #define CSR_STIMECMPH 0x15d
@@ -3474,6 +3524,8 @@
 #define CAUSE_FETCH_PAGE_FAULT 0xc
 #define CAUSE_LOAD_PAGE_FAULT 0xd
 #define CAUSE_STORE_PAGE_FAULT 0xf
+#define CAUSE_SOFTWARE_CHECK_FAULT 0x12
+#define CAUSE_HARDWARE_ERROR_FAULT 0x13
 #define CAUSE_FETCH_GUEST_PAGE_FAULT 0x14
 #define CAUSE_LOAD_GUEST_PAGE_FAULT 0x15
 #define CAUSE_VIRTUAL_INSTRUCTION 0x16
@@ -3702,6 +3754,8 @@ DECLARE_INSN(c_sq, MATCH_C_SQ, MASK_C_SQ)
 DECLARE_INSN(c_sqsp, MATCH_C_SQSP, MASK_C_SQSP)
 DECLARE_INSN(c_srai, MATCH_C_SRAI, MASK_C_SRAI)
 DECLARE_INSN(c_srli, MATCH_C_SRLI, MASK_C_SRLI)
+DECLARE_INSN(c_sspopchk_x5, MATCH_C_SSPOPCHK_X5, MASK_C_SSPOPCHK_X5)
+DECLARE_INSN(c_sspush_x1, MATCH_C_SSPUSH_X1, MASK_C_SSPUSH_X1)
 DECLARE_INSN(c_sub, MATCH_C_SUB, MASK_C_SUB)
 DECLARE_INSN(c_subw, MATCH_C_SUBW, MASK_C_SUBW)
 DECLARE_INSN(c_sw, MATCH_C_SW, MASK_C_SW)
@@ -3748,6 +3802,8 @@ DECLARE_INSN(crc32c_b, MATCH_CRC32C_B, MASK_CRC32C_B)
 DECLARE_INSN(crc32c_d, MATCH_CRC32C_D, MASK_CRC32C_D)
 DECLARE_INSN(crc32c_h, MATCH_CRC32C_H, MASK_CRC32C_H)
 DECLARE_INSN(crc32c_w, MATCH_CRC32C_W, MASK_CRC32C_W)
+DECLARE_INSN(crdxk, MATCH_CRDXK, MASK_CRDXK)
+DECLARE_INSN(crexk, MATCH_CREXK, MASK_CREXK)
 DECLARE_INSN(crsa16, MATCH_CRSA16, MASK_CRSA16)
 DECLARE_INSN(crsa32, MATCH_CRSA32, MASK_CRSA32)
 DECLARE_INSN(csrrc, MATCH_CSRRC, MASK_CSRRC)
@@ -4307,6 +4363,13 @@ DECLARE_INSN(sro, MATCH_SRO, MASK_SRO)
 DECLARE_INSN(sroi, MATCH_SROI, MASK_SROI)
 DECLARE_INSN(sroiw, MATCH_SROIW, MASK_SROIW)
 DECLARE_INSN(srow, MATCH_SROW, MASK_SROW)
+DECLARE_INSN(ssamoswap_d, MATCH_SSAMOSWAP_D, MASK_SSAMOSWAP_D)
+DECLARE_INSN(ssamoswap_w, MATCH_SSAMOSWAP_W, MASK_SSAMOSWAP_W)
+DECLARE_INSN(sspopchk_x1, MATCH_SSPOPCHK_X1, MASK_SSPOPCHK_X1)
+DECLARE_INSN(sspopchk_x5, MATCH_SSPOPCHK_X5, MASK_SSPOPCHK_X5)
+DECLARE_INSN(sspush_x1, MATCH_SSPUSH_X1, MASK_SSPUSH_X1)
+DECLARE_INSN(sspush_x5, MATCH_SSPUSH_X5, MASK_SSPUSH_X5)
+DECLARE_INSN(ssrdp, MATCH_SSRDP, MASK_SSRDP)
 DECLARE_INSN(stas16, MATCH_STAS16, MASK_STAS16)
 DECLARE_INSN(stas32, MATCH_STAS32, MASK_STAS32)
 DECLARE_INSN(stsa16, MATCH_STSA16, MASK_STSA16)
@@ -4903,6 +4966,7 @@ DECLARE_CSR(vstart, CSR_VSTART)
 DECLARE_CSR(vxsat, CSR_VXSAT)
 DECLARE_CSR(vxrm, CSR_VXRM)
 DECLARE_CSR(vcsr, CSR_VCSR)
+DECLARE_CSR(ssp, CSR_SSP)
 DECLARE_CSR(seed, CSR_SEED)
 DECLARE_CSR(jvt, CSR_JVT)
 DECLARE_CSR(cycle, CSR_CYCLE)
@@ -5218,6 +5282,22 @@ DECLARE_CSR(mimpid, CSR_MIMPID)
 DECLARE_CSR(mhartid, CSR_MHARTID)
 DECLARE_CSR(mconfigptr, CSR_MCONFIGPTR)
 DECLARE_CSR(mtopi, CSR_MTOPI)
+DECLARE_CSR(mcrmkeyl, CSR_MCRMKEYL)
+DECLARE_CSR(mcrmkeyh, CSR_MCRMKEYH)
+DECLARE_CSR(scrtkeyl, CSR_SCRTKEYL)
+DECLARE_CSR(scrtkeyh, CSR_SCRTKEYH)
+DECLARE_CSR(scrakeyl, CSR_SCRAKEYL)
+DECLARE_CSR(scrakeyh, CSR_SCRAKEYH)
+DECLARE_CSR(scrbkeyl, CSR_SCRBKEYL)
+DECLARE_CSR(scrbkeyh, CSR_SCRBKEYH)
+DECLARE_CSR(scrckeyl, CSR_SCRCKEYL)
+DECLARE_CSR(scrckeyh, CSR_SCRCKEYH)
+DECLARE_CSR(scrdkeyl, CSR_SCRDKEYL)
+DECLARE_CSR(scrdkeyh, CSR_SCRDKEYH)
+DECLARE_CSR(screkeyl, CSR_SCREKEYL)
+DECLARE_CSR(screkeyh, CSR_SCREKEYH)
+DECLARE_CSR(scrfkeyl, CSR_SCRFKEYL)
+DECLARE_CSR(scrfkeyh, CSR_SCRFKEYH)
 DECLARE_CSR(sieh, CSR_SIEH)
 DECLARE_CSR(siph, CSR_SIPH)
 DECLARE_CSR(stimecmph, CSR_STIMECMPH)
@@ -5362,6 +5442,8 @@ DECLARE_CAUSE("machine_ecall", CAUSE_MACHINE_ECALL)
 DECLARE_CAUSE("fetch page fault", CAUSE_FETCH_PAGE_FAULT)
 DECLARE_CAUSE("load page fault", CAUSE_LOAD_PAGE_FAULT)
 DECLARE_CAUSE("store page fault", CAUSE_STORE_PAGE_FAULT)
+DECLARE_CAUSE("software check fault", CAUSE_SOFTWARE_CHECK_FAULT)
+DECLARE_CAUSE("hardware error fault", CAUSE_HARDWARE_ERROR_FAULT)
 DECLARE_CAUSE("fetch guest page fault", CAUSE_FETCH_GUEST_PAGE_FAULT)
 DECLARE_CAUSE("load guest page fault", CAUSE_LOAD_GUEST_PAGE_FAULT)
 DECLARE_CAUSE("virtual instruction", CAUSE_VIRTUAL_INSTRUCTION)
diff --git a/riscv/insn_template.h b/riscv/insn_template.h
index cead6d7d..2f2112ad 100644
--- a/riscv/insn_template.h
+++ b/riscv/insn_template.h
@@ -9,4 +9,5 @@
 #include "tracer.h"
 #include "p_ext_macros.h"
 #include "v_ext_macros.h"
+#include "qarma.h"
 #include <assert.h>
diff --git a/riscv/processor.cc b/riscv/processor.cc
index 51c9bd88..d7afc9d4 100644
--- a/riscv/processor.cc
+++ b/riscv/processor.cc
@@ -585,6 +585,23 @@ void state_t::reset(processor_t* const proc, reg_t max_isa)
       }
   }
 
+  csrmap[CSR_MCRMKEYH] = std::make_shared<key_csr_t>(proc, CSR_MCRMKEYH, 0);
+  csrmap[CSR_MCRMKEYL] = std::make_shared<key_csr_t>(proc, CSR_MCRMKEYL, 0);
+  csrmap[CSR_SCRAKEYH] = std::make_shared<key_csr_t>(proc, CSR_SCRAKEYH, 0);
+  csrmap[CSR_SCRAKEYL] = std::make_shared<key_csr_t>(proc, CSR_SCRAKEYL, 0);
+  csrmap[CSR_SCRBKEYH] = std::make_shared<key_csr_t>(proc, CSR_SCRBKEYH, 0);
+  csrmap[CSR_SCRBKEYL] = std::make_shared<key_csr_t>(proc, CSR_SCRBKEYL, 0);
+  csrmap[CSR_SCRCKEYH] = std::make_shared<key_csr_t>(proc, CSR_SCRCKEYH, 0);
+  csrmap[CSR_SCRCKEYL] = std::make_shared<key_csr_t>(proc, CSR_SCRCKEYL, 0);
+  csrmap[CSR_SCRDKEYH] = std::make_shared<key_csr_t>(proc, CSR_SCRDKEYH, 0);
+  csrmap[CSR_SCRDKEYL] = std::make_shared<key_csr_t>(proc, CSR_SCRDKEYL, 0);
+  csrmap[CSR_SCREKEYH] = std::make_shared<key_csr_t>(proc, CSR_SCREKEYH, 0);
+  csrmap[CSR_SCREKEYL] = std::make_shared<key_csr_t>(proc, CSR_SCREKEYL, 0);
+  csrmap[CSR_SCRFKEYH] = std::make_shared<key_csr_t>(proc, CSR_SCRFKEYH, 0);
+  csrmap[CSR_SCRFKEYL] = std::make_shared<key_csr_t>(proc, CSR_SCRFKEYL, 0);
+  csrmap[CSR_SCRTKEYH] = std::make_shared<key_csr_t>(proc, CSR_SCRTKEYH, 0);
+  csrmap[CSR_SCRTKEYL] = std::make_shared<key_csr_t>(proc, CSR_SCRTKEYL, 0);
+
   serialized = false;
 
   log_reg_write.clear();
diff --git a/riscv/processor.h b/riscv/processor.h
index 0a073adf..21b8a3ed 100644
--- a/riscv/processor.h
+++ b/riscv/processor.h
@@ -113,6 +113,22 @@ struct state_t
   csr_t_p stvec;
   virtualized_csr_t_p satp;
   csr_t_p scause;
+  csr_t_p mcrmkeyh;
+  csr_t_p mcrmkeyl;
+  csr_t_p scrakeyh;
+  csr_t_p scrakeyl;
+  csr_t_p scrbkeyh;
+  csr_t_p scrbkeyl;
+  csr_t_p scrckeyh;
+  csr_t_p scrckeyl;
+  csr_t_p scrdkeyh;
+  csr_t_p scrdkeyl;
+  csr_t_p screkeyh;
+  csr_t_p screkeyl;
+  csr_t_p scrfkeyh;
+  csr_t_p scrfkeyl;
+  csr_t_p scrtkeyh;
+  csr_t_p scrtkeyl;
 
   // When taking a trap into HS-mode, we must access the nonvirtualized HS-mode CSRs directly:
   csr_t_p nonvirtual_stvec;
diff --git a/riscv/riscv.mk.in b/riscv/riscv.mk.in
index 31af737e..9de21d08 100644
--- a/riscv/riscv.mk.in
+++ b/riscv/riscv.mk.in
@@ -46,6 +46,7 @@ riscv_install_hdrs = \
 	trap.h \
 	triggers.h \
 	vector_unit.h \
+	qarma.h \
 
 riscv_precompiled_hdrs = \
 	insn_template.h \
@@ -74,6 +75,7 @@ riscv_srcs = \
 	vector_unit.cc \
 	socketif.cc \
 	cfg.cc \
+	qarma.cc \
 	$(riscv_gen_srcs) \
 
 riscv_test_srcs = \
@@ -135,6 +137,8 @@ riscv_insn_ext_i = \
 	xori \
 	fence \
 	fence_i \
+	crexk \
+	crdxk \
 
 riscv_insn_ext_a = \
 	amoadd_d \
